//
帮我划分下周期
上涨线段, 过度线段 和 下跌线段 要填充带有透明度的背景色
去掉 ema21 大于ema52 的条件的必要条件


现在的代码有在橙色的区间不做多吗?
开仓是满足在紫色和绿色区间 但是为什么有多时候橙色区间也会做多单?
帮我找出单橙色区间做多的原因


//突破区域的阈值 DEA -130了: 2025-09-05
多单 DEA<0 就止损 多单一定要是阳线进场, 多单突破ema21 or ema52 都可以进场
把橙色区域的切换 变成不以固定k线数量为标准 二十变成 当ema21 小于ema52 的时候就变成红色下跌区间不做多单, 同时逻辑变成橙色区域可以做多


取消无效代码 止盈参数 和其他没有用到的变量
策略允许多空双开 多单有仓位的时候可以开空, 且在橙色区域不做单,紫色突破区域还是限制在-80吧
上涨线段的确认再加入一个条件 ema21 > ema52
你可以在1h 加入适用于btc的 ATR 来过滤横盘场景不做单吗?


更新下紫色的过渡线段, 出现紫色过渡线段后 当DEA 大于 280 的时候才正式变成 上涨线段, 否则仍未
且在紫色线段不做多单, 这个为 定义上涨线段的dea 阈值, 取消固定k线数的限制



对于已经止损的单子进行加入新条件判断
1. 如果是上涨线段中的 多单止损, 止损后计算盈利幅度 若小于 0.3% 则之后判断EMA6 是否 小于当前价格 （ema52-ema144）*2 + ema144
如果ema6 位于这个区间中就不允许再次开多单
2. 如果是下跌线段中的 空单止损, 计算盈利幅度为小于 0.3% 之后判断EMA6 是否 大于当前价格 ema144-(ema144-ema52）*2 
如果ema6 位于这个区间中就不允许再次开空单


//绘制震荡过滤 灰色背景 
在触发盈利条件条件小于0,3%的时候  绘制一个背景为淡灰色的(ema52-ema144)*2+ema144 和 ema144-(ema144-ema52)*2  的背景


这个逻辑有问题
在上涨线段中 多单止损后 计算盈利幅度 若小于 0.3% 
则不开单 计算 long_ema6_in_block_zone, 这个zone 的p_long_block_lower 是ema 144 -(ema52-ema144)*2,  p_long_block_upper 是 (ema52-ema144)*2 + ema144
相反: 在下跌线段中 空单止损后 计算盈利幅度 若小于0.3%
则不开单 计算 short_ema6_in_block_zone, 这个zone 的 p_short_block_upper 是 ema144 + (ema144-ema5)*2,  p_short_block_lower 是 ema144-(ema144-ema52 )*2


同时这个线段划分有问题 只有上涨线段 和 下跌线段, 这个程序中从下跌线段 hui zhi 到上涨线段没有满足阈值的过滤条件
且上涨线段结束的时候 设置一个阈值代替k线数量 阈值为500
下得线段dea 大于0的时候同样设置一个阈值代替k线数量 阈值为 -500
1.如果某次多或者空， 盈利少于百分之0.3然后进行上述条件判断 如果满足进入50根k线冷却期,去掉之前的震荡过滤的判断的背景绘制
2.冷却期内不进行任何开仓操作
同时清理掉无用代码, 只保留和绘制两个上涨线段和下跌线段


加入做多单的模糊止损ema52-200, 空单模糊止损ema52+200
且在k线价格突破的时候进场 而不是首先后再进场