# MACD
EMA 21 均线系统
只做btc

进场条件:

main: 从ema 52 穿过 ema 21，52在21之下，macd线呈上升趋势
(如果4h 慢线大于0 and 4小时的白线减去当前柱高度<800)  or   小于0且柱子为绿色,

如果4h 慢线 < 0 且 白线-当前柱高大于1000  and  柱子大于 -30 并且 黄白线差值 小于200
1. 
止损：跌破ema52并且在ema52-300点
止盈：超破前高出百分之50，后续再跌破ema52并且在ema52+100点止损


2. 遇到正向阴阳冕做空，遇到反向做多
止损:阴阳冕最后一根绿柱对应的k线的高点正向+50点，反向-50点
止盈：阴阳冕当前时间周期的ema52正向+20点，反向-20点


2025-10-14
1. 增加适配全部的不同的时间周期 1h + 4h or 更大级别 
2. 加入限制条件1: 上涨线段要满足ema21 大于ema52; 限制条件二 4小时macd 的快线高度不可以大于1500
3. 加入新的止盈条件 第一次主动止盈 k线超过近期k线的前高就止盈, 第二次跌破ema52 被动止盈
4. 去掉无限时间级别的纠缠场景, 一次止损后 50bar后不再开单
5. 加入在零轴下的突破场景 当慢线高度大于-60的时候就计算成上涨区间用浅黄背景表示,若8bar之后未成功穿越0轴则仍未下跌区间

1. 分批平仓功能 (MACD.pine:175-187)
第一次止盈：突破近期前高时，使用 qty_percent=50 平掉50%仓位
第二次止盈：跌破EMA52时，平掉剩余仓位
使用 first_tp_triggered 标志防止重复触发

2. 止损冷却机制 (MACD.pine:118-139)
检测止损：跌破EMA52且未触发第一次止盈时视为止损
止损后记录 last_stop_loss_bar
冷却期：止损后50根K线内不允许新开仓（可在参数中调整）
入场条件新增 cooldown_filter 检查

3. 零轴下突破场景 (MACD.pine:90-111)
触发条件：
DEA在零轴下方（dea < 0）
DEA高于阈值（默认 -60）
