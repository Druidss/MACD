# BTC 动能理论体系

> **重要**：本文件定义了 BTC 动能分析的完整理论框架。所有分析脚本都会读取此文件中的规则和参数。请根据你的交易系统完整填写所有章节。

---

## 目录

1. [核心原理](#核心原理)
2. [基础概念定义](#基础概念定义)
   - 上涨线段
   - 下跌线段
   - 过渡期
3. [高级概念定义](#高级概念定义)
   - 单位调整周期
   - 分立调控
   - 连续跳空
   - 隐形信号
4. [背离分析](#背离分析)
   - 连续跳空背离
   - 分立跳空背离
   - 黄白线背离
   - 隐形背离
5. [买卖点规则](#买卖点规则)
6. [时间级别联动](#时间级别联动)
7. [参数配置](#参数配置)

---

## 核心原理

### MACD 动力学本质

> 请在此描述你对 MACD 动能理论的核心理解

**示例填写**：
```
MACD 动能理论的本质是通过 DIF（黄线）和 DEA（白线）的相对关系，以及 Histogram（柱状图）的变化，
来识别市场的动能强度、方向和衰竭程度。

核心要素：
1. DIF - DEA 的差值（Histogram）反映当前动能的瞬时强度
2. DEA 的 0 轴穿越标志着趋势的根本性转变
3. 柱状图的连续变化模式揭示动能的持续性和衰竭
4. 多时间级别的嵌套关系反映市场的层级结构

关键假设：
- 动能先于价格变化
- 动能的衰竭会导致趋势反转
- 大周期动能决定小周期的有效性
```

### 线段理论与 MACD 的关系

> 请描述线段概念如何与 MACD 指标关联

**示例填写**：
```
线段是市场趋势的基本单元，通过 MACD 的 DEA 指标与 0 轴的关系来定义：

上涨线段 = DEA 持续在 0 轴上方 + [你的额外条件]
下跌线段 = DEA 持续在 0 轴下方 + [你的额外条件]

线段内部包含多个"单位调整周期"，每个周期代表一次动能的释放和调整过程。
```

---

## 基础概念定义

### 1. 上涨线段

#### 定义

> 请给出上涨线段的精确定义

**示例填写**：
```
上涨线段是指 MACD 的 DEA（白线）上穿 0 轴，并满足以下条件的市场阶段：

必要条件：
1. DEA > 0（必须）
2. [你补充的条件 1，例如：持续时间 >= N 根 K 线]
3. [你补充的条件 2，例如：EMA26 > EMA52]

充分条件（满足任一即可确认强势上涨）：
1. [条件 A，例如：DIF > DEA 且 Histogram 持续扩张]
2. [条件 B，例如：连续 3 根 K 线 DEA 上升]
```

#### 识别算法

> 请描述如何在代码中识别上涨线段

**示例填写**：
```python
def is_uptrend_segment(candles, index):
    """
    判断指定位置是否处于上涨线段

    参数：
    - candles: K 线数据数组（包含 DEA, DIF, Histogram 等）
    - index: 要判断的 K 线索引

    返回：
    - True/False

    算法：
    1. 检查 DEA[index] > 0
    2. 向前回溯 [N] 根 K 线，确认 DEA 持续 > 0
    3. 检查 EMA26 > EMA52
    4. [你的其他检查条件]
    """
    # 你可以在此补充伪代码或详细步骤
```

#### 子阶段划分（可选）

> 如果上涨线段内部有子阶段，请在此定义

**示例填写**：
```
上涨线段可细分为：
1. 初期加速阶段：DEA 刚上穿 0 轴，Histogram 快速扩张
2. 中期持续阶段：DEA 稳定在高位，Histogram 波动但保持正值
3. 晚期衰竭阶段：DEA 仍 > 0，但 Histogram 开始收缩
```

### 2. 下跌线段

#### 定义

> 请给出下跌线段的精确定义

**示例填写**：
```
下跌线段是指 MACD 的 DEA（白线）下穿 0 轴，并满足以下条件的市场阶段：

必要条件：
1. DEA < 0（必须）
2. [你补充的条件 1]
3. [你补充的条件 2]

确认延迟：
- DEA 下穿 0 轴后，需等待 [N] 根 K 线才正式确认为下跌线段
- 原因：[你的理由，例如：避免假突破]
```

#### 识别算法

> 请描述如何识别下跌线段

**示例填写**：
```python
def is_downtrend_segment(candles, index):
    """
    判断指定位置是否处于下跌线段

    你的算法描述...
    """
```

### 3. 过渡期

#### 定义

> 请定义线段转换过程中的过渡期

**示例填写**：
```
过渡期是指从一个线段转向另一个线段的中间状态：

上涨 → 下跌的过渡期：
- 触发：DEA 下穿 0 轴
- 持续时间：[N] 根 K 线
- 特征：[你补充的特征]

下跌 → 上涨的过渡期：
- 触发：DEA 上穿 0 轴
- 持续时间：[M] 根 K 线
- 特征：[你补充的特征]
```

#### 过渡期的交易含义

> 过渡期是否可以交易？规则是什么？

**示例填写**：
```
过渡期交易规则：
1. 上涨 → 下跌过渡期：[可以/不可以] 做空，原因：[...]
2. 下跌 → 上涨过渡期：[可以/不可以] 做多，原因：[...]
```

---

## 高级概念定义

### 1. 单位调整周期

#### 定义

> 这是你的核心概念之一，请详细定义

**示例填写**：
```
单位调整周期是指在一个线段内部，MACD 柱状图从扩张到收缩再到扩张的完整循环。

识别标准：
1. 起点：Histogram 开始扩张（[正值/负值]，取决于线段方向）
2. 中点：Histogram 达到局部极值后开始收缩
3. 终点：Histogram 收缩至 [阈值]，或者反向扩张开始

一个上涨线段通常包含 [1-3] 个单位调整周期。

示例：
上涨线段中的第 1 个单位调整周期：
- K线 #1-5：Histogram 从 +10 扩张至 +50（高点）
- K线 #6-8：Histogram 从 +50 收缩至 +15
- K线 #9：开始第 2 个周期（Histogram 再次扩张）
```

#### 周期编号规则

> 如何判断当前处于第几个周期？

**示例填写**：
```
周期编号从 1 开始：
1. 线段刚确认时为第 1 个周期
2. 每当 Histogram 完成一次"扩张-收缩"循环，周期数 +1
3. 最大周期数通常不超过 [3]，超过则视为线段即将结束

第 1 个周期的特征：[...]
第 2 个周期的特征：[...]
第 3+ 个周期的特征：[...]
```

#### 算法伪代码

```python
def count_adjustment_cycles(candles, segment_start_index):
    """
    计算从线段开始到当前位置，经历了几个单位调整周期

    你的算法...
    """
```

### 2. 分立调控

#### 定义

> 请定义什么是分立调控

**示例填写**：
```
分立调控是指 MACD 柱状图在调整过程中，出现离散的、非连续的动能释放模式。

典型特征：
1. Histogram 不是平滑收缩，而是呈现"收缩-反弹-再收缩"的锯齿状
2. 出现 [N] 根以上的非同向 K 线（例如：正柱、负柱、正柱交替）
3. [你补充的其他特征]

与"连续调控"的区别：
- 连续调控：Histogram 平滑地单向收缩或扩张
- 分立调控：Histogram 在收缩过程中出现反向波动

市场含义：
分立调控通常表示 [你的解读，例如：市场犹豫不决，多空争夺激烈]
```

#### 识别算法

```python
def detect_discrete_control(candles, start_index, end_index):
    """
    检测指定区间是否存在分立调控

    返回：
    - is_discrete: True/False
    - pattern: 描述具体模式（例如："3 正 2 负 2 正"）

    你的算法...
    """
```

### 3. 连续跳空

#### 定义

> 请定义 MACD 柱状图的"跳空"

**示例填写**：
```
连续跳空是指 MACD 柱状图在连续的 K 线上出现显著的数值跳跃（gap）。

跳空的判断标准：
1. |Histogram[i] - Histogram[i-1]| > [阈值，例如：5]
2. 方向一致性：Histogram[i] 和 Histogram[i-1] 同号（都为正或都为负）
3. 连续性：至少连续 [N] 根 K 线满足上述条件

跳空的方向：
- 正向跳空：Histogram 连续向正方向跳跃（动能加速上涨）
- 负向跳空：Histogram 连续向负方向跳跃（动能加速下跌）

市场含义：
连续跳空表示 [你的解读，例如：动能突然加速，可能是突破或衰竭的前兆]
```

#### 检测算法

```python
def detect_consecutive_gaps(candles, lookback=10):
    """
    检测最近 lookback 根 K 线中的连续跳空

    返回：
    - gaps: 跳空位置列表
    - direction: 'positive' / 'negative'
    - magnitude: 跳空幅度

    你的算法...
    """
```

### 4. 隐形信号

#### 定义

> 请定义什么是"隐形"信号

**示例填写**：
```
隐形信号是指不明显但具有重要意义的动能变化，通常需要结合多个指标才能识别。

典型的隐形信号：
1. [信号 A，例如：Histogram 在高位长时间横盘，表面平静但暗藏风险]
2. [信号 B，例如：DIF 与 DEA 的间距持续缩小，虽未死叉但动能衰竭]
3. [信号 C]

识别条件：
- [条件 1]
- [条件 2]

与常规信号的区别：
隐形信号不会触发明显的指标变化（如死叉、0 轴穿越），但往往是趋势反转的早期预警。
```

---

## 背离分析

### 1. 连续跳空背离

#### 定义

> 请定义连续跳空背离

**示例填写**：
```
连续跳空背离是指价格与 MACD 柱状图同时满足以下条件：

1. 价格创新高（或新低）
2. MACD Histogram 未创新高（或新低）
3. 同时检测到"连续跳空"（见上文定义）

类型：
- 顶背离：价格新高 + Histogram 未新高 + 负向连续跳空
- 底背离：价格新低 + Histogram 未新低 + 正向连续跳空

确认条件：
- 需要至少 [N] 根 K 线的跳空序列
- 价格高点/低点间隔至少 [M] 根 K 线

市场含义：
连续跳空背离是 [你的解读，例如：极强的反转信号，优先级高于普通背离]
```

#### 检测算法

```python
def detect_continuous_gap_divergence(candles, lookback=50):
    """
    检测连续跳空背离

    返回：
    - type: 'bullish' / 'bearish' / None
    - confidence: 0.0 - 1.0
    - positions: 背离点的位置索引

    你的算法...
    """
```

### 2. 分立跳空背离

#### 定义

> 与连续跳空背离的区别是什么？

**示例填写**：
```
分立跳空背离是指在离散的、不连续的 K 线位置出现跳空，且与价格形成背离。

与连续跳空背离的区别：
- 连续跳空背离：跳空发生在连续的 K 线上
- 分立跳空背离：跳空发生在间隔的 K 线上（中间有非跳空 K 线）

示例：
K线 #1: Histogram +10
K线 #2: Histogram +15 (跳空 +5)
K线 #3: Histogram +16 (无跳空)
K线 #4: Histogram +22 (跳空 +6)
→ 这是分立跳空（K线 #2 和 #4 跳空，但不连续）

市场含义：
[你的解读]
```

### 3. 黄白线背离

#### 定义

> 请定义 DIF（黄线）与 DEA（白线）的背离

**示例填写**：
```
黄白线背离是指 DIF（快线）与 DEA（慢线）的相对关系发生变化，但 DEA 仍保持原有趋势。

类型：
1. 顶背离（死叉背离）：
   - DIF 下穿 DEA（死叉）
   - 但 DEA 仍在高位或仍在上升
   - Histogram 由正转负

2. 底背离（金叉背离）：
   - DIF 上穿 DEA（金叉）
   - 但 DEA 仍在低位或仍在下降
   - Histogram 由负转正

确认条件：
- [条件 1，例如：死叉/金叉至少持续 3 根 K 线]
- [条件 2]

与价格背离的区别：
- 价格背离：价格与 MACD 整体背离
- 黄白线背离：DIF 与 DEA 内部背离

市场含义：
黄白线背离通常表示 [你的解读，例如：动能转换的早期信号]
```

### 4. 隐形背离

#### 定义

> 请定义隐形背离

**示例填写**：
```
隐形背离是指价格与 MACD 的背离不明显，需要结合多个维度才能识别。

典型情况：
1. [情况 A，例如：价格创新高，但 MACD 虽也创新高，增速明显放缓]
2. [情况 B]

识别方法：
- 对比两次高点/低点的 [指标 1]
- 计算 [指标 2] 的变化率
- 检查 [条件 3]

市场含义：
[你的解读]
```

---

## 买卖点规则

> **核心章节**：请在此定义你的买卖点触发条件

### 买点规则

#### 买点类型 1：[名称，例如："线段确认买点"]

**触发条件**：
```
必要条件（全部满足）：
1. [条件 1，例如：DEA 上穿 0 轴]
2. [条件 2，例如：EMA26 > EMA52]
3. [条件 3，例如：无黄白线顶背离]

充分条件（满足任一即可）：
1. [条件 A]
2. [条件 B]

时间级别要求：
- 主要时间级别：[例如：1h]
- 确认时间级别：[例如：4h 同向上涨线段]
- 禁止时间级别：[例如：2h 处于下跌线段时不开多]
```

**入场参数**：
```
入场价位：[例如：当前收盘价，或 EMA26 支撑位]
仓位大小：[例如：账户的 10%]
有效期：[例如：信号出现后 3 根 K 线内]
```

**止损设置**：
```
止损位：[例如：EMA52 - 300 点]
止损逻辑：[例如：收盘价跌破止损位]
移动止损：[是否启用，规则是什么]
```

**止盈设置**：
```
止盈位 1：[例如：前高压力位]
止盈位 2：[例如：跌破 EMA26]
分批止盈：[例如：止盈位 1 平 50%，止盈位 2 平剩余]
```

#### 买点类型 2：[名称]

**触发条件**：
```
[你的定义]
```

#### 买点类型 3：[名称]

**触发条件**：
```
[你的定义]
```

### 卖点规则

#### 卖点类型 1：[名称，例如："止损卖点"]

**触发条件**：
```
[你的定义]
```

#### 卖点类型 2：[名称，例如："线段转换卖点"]

**触发条件**：
```
[你的定义]
```

#### 卖点类型 3：[名称]

**触发条件**：
```
[你的定义]
```

### 做空规则（可选）

> 如果你的系统包含做空规则，请在此定义

**空单入场条件**：
```
[你的定义]
```

**空单止损止盈**：
```
[你的定义]
```

---

## 时间级别联动

> **核心章节**：请定义多时间级别如何相互影响

### 层级关系

**时间级别优先级**（从高到低）：
```
1. 2日线（最高级别）
2. 1日线
3. 12小时
4. 6小时
5. 4小时
6. 2小时
7. 1小时
8. 30分钟（最低级别）
```

**上级对下级的影响**：
```
规则 1：[例如：如果 2日线 处于下跌线段，则 1日线 的买点信号无效]
规则 2：[例如：如果 1日线 和 12h 均为上涨线段，则 1h 买点置信度 +20%]
规则 3：[...]
```

**下级对上级的反馈**：
```
规则 1：[例如：如果 1h 出现连续跳空背离，需警惕 4h 线段即将转换]
规则 2：[...]
```

### 共振条件

**多周期共振买点**：
```
触发条件：
1. [主要时间级别，例如：1h] 出现买点信号
2. [确认时间级别 1，例如：4h] 满足 [条件]
3. [确认时间级别 2，例如：1d] 满足 [条件]

共振级别：
- 3 个时间级别共振：[强度，例如：高]
- 2 个时间级别共振：[强度，例如：中]
- 仅单一时间级别：[强度，例如：低]

置信度加成：
共振时间级别越多，买点置信度越高。
```

**多周期矛盾处理**：
```
情况 1：大周期上涨，小周期下跌
处理方式：[例如：等待小周期企稳后顺大周期做多]

情况 2：大周期下跌，小周期上涨
处理方式：[例如：小周期反弹视为大周期的回调，可短线做空]

情况 3：[其他矛盾情况]
处理方式：[...]
```

### 嵌套分析流程

**分析顺序**：
```
1. 从大到小依次分析各时间级别
2. 识别每个级别的线段状态和单位周期
3. 检测各级别的背离信号
4. 汇总联动关系，给出综合判断
```

**联动判断矩阵示例**：
```
| 2日线 | 1日线 | 12h   | 6h    | 4h    | 2h    | 1h    | 30m   | 综合判断           |
|-------|-------|-------|-------|-------|-------|-------|-------|--------------------|
| 上涨  | 上涨  | 上涨  | 上涨  | 上涨  | 上涨  | 上涨  | 上涨  | 强势多头（做多）   |
| 上涨  | 上涨  | 上涨  | 调整  | 调整  | 下跌  | 下跌  | 下跌  | 大周期多头，小周期回调（等待买点） |
| 下跌  | 下跌  | 下跌  | 下跌  | 上涨  | 上涨  | 上涨  | 上涨  | 小周期反弹（短线做空或观望） |

[你可以补充更多场景]
```

---

## 参数配置

> 所有可调整的参数集中在此配置

### EMA 参数

```yaml
ema_short: 26   # 短期均线
ema_long: 52    # 中期均线
```

### MACD 参数

```yaml
macd_fast: 12    # 快线周期
macd_slow: 26    # 慢线周期
macd_signal: 9   # 信号线周期
```

### 线段确认参数

```yaml
# 上涨线段确认
uptrend_min_bars: [你填写，例如：2]   # 最少确认 K 线数

# 下跌线段确认
downtrend_delay_bars: [你填写，例如：25]   # DEA 下穿 0 轴后延迟确认 K 线数

# 零轴突破
below_zero_threshold: [你填写，例如：-60]   # DEA 阈值
below_zero_timeout: [你填写，例如：8]       # 突破超时 K 线数
```

### 跳空检测参数

```yaml
gap_threshold: [你填写，例如：5]        # Histogram 变化幅度阈值
consecutive_gap_min: [你填写，例如：2]  # 最少连续跳空 K 线数
```

### 背离检测参数

```yaml
divergence_lookback: [你填写，例如：50]     # 背离检测回溯 K 线数
divergence_min_distance: [你填写，例如：10] # 两次高点/低点最小间隔
```

### 止损止盈参数

```yaml
# 多单
long_stop_loss_offset: [你填写，例如：300]  # EMA52 - offset
long_take_profit_1: [你填写，例如："前高"]
long_take_profit_2: [你填写，例如："EMA26 破位"]

# 空单
short_stop_loss_offset: [你填写，例如：0]   # EMA52 + offset
short_take_profit_1: [你填写]
short_take_profit_2: [你填写]
```

### 时间级别权重

> 用于多时间级别综合评分

```yaml
timeframe_weights:
  2d: [你填写，例如：1.0]   # 最高权重
  1d: [你填写，例如：0.8]
  12h: [你填写，例如：0.6]
  6h: [你填写，例如：0.5]
  4h: [你填写，例如：0.4]
  2h: [你填写，例如：0.3]
  1h: [你填写，例如：0.2]
  30m: [你填写，例如：0.1]  # 最低权重
```

---

## 使用说明

1. **填写要求**：
   - 请替换所有 `[你填写]`、`[你补充]`、`[...]` 等占位符
   - 算法伪代码可以保持简洁，但逻辑必须清晰
   - 参数的数值必须明确，不能使用范围或模糊描述

2. **优先级**：
   - 核心章节：买卖点规则、时间级别联动、参数配置
   - 次要章节：高级概念、背离分析
   - 可选章节：算法伪代码（可用自然语言描述代替）

3. **验证**：
   - 填写完成后，建议用几个真实的 BTC 历史数据测试你的规则
   - 检查规则之间是否有冲突或遗漏

4. **更新**：
   - 根据实盘表现随时调整参数
   - 每次更新后记录修改原因和日期

---

## 版本历史

| 日期       | 版本  | 修改内容                     | 修改人 |
|------------|-------|------------------------------|--------|
| 2025-12-10 | 1.0.0 | 初始框架创建                 | Claude |
| [日期]     | [版本]| [你的修改内容]               | [你]   |

---

**注意**：本文件是 BTC 动能分析 Skill 的核心配置文件，所有分析脚本都会读取此文件。请确保定义完整且逻辑自洽。
